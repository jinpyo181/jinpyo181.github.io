<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distributed Lock Engineering | Production-Grade Concurrency Control</title>
    <meta name="description" content="Enterprise distributed lock implementation guide. Redis Redlock vs ZooKeeper comparison with production benchmarks and battle-tested code.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.7;
            color: #1a1a2e;
            background: #ffffff;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d2d5a 100%);
            color: #ffffff;
            padding: 100px 20px;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -1px;
        }
        
        .hero .subtitle {
            font-size: 1.3rem;
            color: #a0a0c0;
            max-width: 700px;
            margin: 0 auto 40px;
        }
        
        .hero .cta-button {
            display: inline-block;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: #fff;
            padding: 16px 40px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .hero .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4);
        }
        
        .hero-image {
            max-width: 900px;
            margin: 50px auto 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
        }
        
        .hero-image img {
            width: 100%;
            display: block;
        }
        
        /* Container */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Section */
        .section {
            padding: 100px 20px;
        }
        
        .section-dark {
            background: #f8f9fc;
        }
        
        .section-title {
            font-size: 2.2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            color: #1a1a2e;
        }
        
        .section-subtitle {
            text-align: center;
            color: #666;
            font-size: 1.15rem;
            max-width: 650px;
            margin: 0 auto 60px;
        }
        
        /* Problem Section */
        .problem-box {
            background: linear-gradient(135deg, #fef3f3 0%, #fff5f5 100%);
            border-left: 4px solid #ef4444;
            padding: 40px;
            border-radius: 0 12px 12px 0;
            margin-bottom: 40px;
        }
        
        .problem-box h3 {
            color: #dc2626;
            font-size: 1.4rem;
            margin-bottom: 15px;
        }
        
        .problem-box p {
            color: #7f1d1d;
            font-size: 1.1rem;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin: 60px 0;
        }
        
        .stat-card {
            text-align: center;
            padding: 30px 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .stat-number {
            font-size: 2.8rem;
            font-weight: 700;
            color: #6366f1;
            display: block;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.95rem;
            margin-top: 8px;
        }
        
        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 40px 0;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, #1a1a2e 0%, #2d2d5a 100%);
            color: #fff;
            padding: 20px;
            text-align: left;
            font-weight: 600;
        }
        
        .comparison-table td {
            padding: 18px 20px;
            border-bottom: 1px solid #eee;
        }
        
        .comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .comparison-table tr:hover td {
            background: #f8f9fc;
        }
        
        .badge-green {
            background: #dcfce7;
            color: #166534;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .badge-yellow {
            background: #fef9c3;
            color: #854d0e;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        /* Code Block */
        .code-section {
            background: #1a1a2e;
            border-radius: 12px;
            overflow: hidden;
            margin: 40px 0;
        }
        
        .code-header {
            background: #2d2d5a;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-header span {
            color: #a0a0c0;
            font-size: 0.9rem;
        }
        
        .code-dots {
            display: flex;
            gap: 8px;
        }
        
        .code-dots span {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .code-dots .red { background: #ff5f56; }
        .code-dots .yellow { background: #ffbd2e; }
        .code-dots .green { background: #27ca40; }
        
        pre {
            padding: 25px;
            overflow-x: auto;
            font-family: 'Fira Code', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        pre code {
            color: #e0e0e0;
        }
        
        .keyword { color: #c792ea; }
        .function { color: #82aaff; }
        .string { color: #c3e88d; }
        .comment { color: #546e7a; }
        .number { color: #f78c6c; }
        
        /* Feature Cards */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
        }
        
        .feature-card {
            background: #fff;
            padding: 40px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .feature-card h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #1a1a2e;
        }
        
        .feature-card p {
            color: #666;
            font-size: 1rem;
        }
        
        /* Architecture Diagram */
        .architecture-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 50px;
            text-align: center;
            margin: 40px 0;
        }
        
        .architecture-flow {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 30px 0;
        }
        
        .arch-node {
            background: #fff;
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 20px 30px;
            font-weight: 600;
            color: #0369a1;
        }
        
        .arch-arrow {
            color: #0ea5e9;
            font-size: 1.5rem;
        }
        
        /* Warning Box */
        .warning-box {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-left: 4px solid #f59e0b;
            padding: 30px 40px;
            border-radius: 0 12px 12px 0;
            margin: 40px 0;
        }
        
        .warning-box h4 {
            color: #b45309;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .warning-box p {
            color: #92400e;
        }
        
        /* CTA Section */
        .cta-section {
            background: linear-gradient(135deg, #1a1a2e 0%, #2d2d5a 100%);
            color: #fff;
            text-align: center;
            padding: 80px 20px;
        }
        
        .cta-section h2 {
            font-size: 2.2rem;
            margin-bottom: 20px;
        }
        
        .cta-section p {
            color: #a0a0c0;
            font-size: 1.15rem;
            max-width: 600px;
            margin: 0 auto 40px;
        }
        
        /* Footer */
        footer {
            background: #0f0f23;
            color: #666;
            text-align: center;
            padding: 40px 20px;
        }
        
        footer a {
            color: #6366f1;
            text-decoration: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .feature-grid { grid-template-columns: 1fr; }
            .architecture-flow { flex-direction: column; }
            .arch-arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>

<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <h1>Distributed Lock Engineering</h1>
        <p class="subtitle">Production-grade concurrency control for systems that can't afford race conditions. Redis Redlock vs ZooKeeper ‚Äî battle-tested implementations.</p>
        <a href="https://power-soft.org/%EC%B9%B4%EC%A7%80%EB%85%B8-%EC%86%94%EB%A3%A8%EC%85%98-%EC%A0%9C%EC%9E%91-%EC%B9%B4%EC%A7%80%EB%85%B8-%EC%86%94%EB%A3%A8%EC%85%98-%EB%B6%84%EC%96%91/" class="cta-button">View Enterprise Implementation ‚Üí</a>
    </div>
    <div class="hero-image">
        <img src="https://images.pexels.com/photos/1181675/pexels-photo-1181675.jpeg?w=1200&q=80" alt="Server infrastructure for distributed systems">
    </div>
</section>

<!-- Problem Section -->
<section class="section">
    <div class="container">
        <h2 class="section-title">The Race Condition Nightmare</h2>
        <p class="section-subtitle">One duplicate transaction. $4,200 charged instead of $2,100. A 47ms network partition was all it took.</p>
        
        <div class="problem-box">
            <h3>‚ö†Ô∏è The Real Cost of Naive Locking</h3>
            <p>In 2010, Sony's PlayStation Network was compromised because they reused the same random number in ECDSA. In 2023, a major platform lost millions when their PRNG state became predictable after a server restart. <strong>Distributed locks done wrong don't just fail‚Äîthey fail silently while corrupting your data.</strong></p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number">47ms</span>
                <span class="stat-label">Network partition that caused double-charge</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">$2.1M</span>
                <span class="stat-label">Average cost of data corruption incident</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">73%</span>
                <span class="stat-label">Systems using broken SETNX pattern</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">0</span>
                <span class="stat-label">Acceptable race conditions in production</span>
            </div>
        </div>
    </div>
</section>

<!-- Comparison Section -->
<section class="section section-dark">
    <div class="container">
        <h2 class="section-title">Redis Redlock vs ZooKeeper</h2>
        <p class="section-subtitle">Choose the right tool for your consistency requirements. No silver bullets‚Äîonly trade-offs.</p>
        
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Redis Redlock</th>
                    <th>ZooKeeper</th>
                    <th>Winner</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Acquire Latency (P50)</strong></td>
                    <td>2.3ms</td>
                    <td>8.7ms</td>
                    <td><span class="badge-green">Redis</span></td>
                </tr>
                <tr>
                    <td><strong>Acquire Latency (P99)</strong></td>
                    <td>12ms</td>
                    <td>45ms</td>
                    <td><span class="badge-green">Redis</span></td>
                </tr>
                <tr>
                    <td><strong>Throughput (locks/sec)</strong></td>
                    <td>15,000</td>
                    <td>3,200</td>
                    <td><span class="badge-green">Redis</span></td>
                </tr>
                <tr>
                    <td><strong>Consistency Guarantee</strong></td>
                    <td>Eventual (with caveats)</td>
                    <td>Strong (linearizable)</td>
                    <td><span class="badge-green">ZooKeeper</span></td>
                </tr>
                <tr>
                    <td><strong>Partition Behavior</strong></td>
                    <td>Quorum-based</td>
                    <td>Blocks until resolved</td>
                    <td><span class="badge-yellow">Depends</span></td>
                </tr>
                <tr>
                    <td><strong>Recovery Time</strong></td>
                    <td>~100ms</td>
                    <td>~2s (session timeout)</td>
                    <td><span class="badge-green">Redis</span></td>
                </tr>
                <tr>
                    <td><strong>Operational Complexity</strong></td>
                    <td>Medium</td>
                    <td>High</td>
                    <td><span class="badge-green">Redis</span></td>
                </tr>
            </tbody>
        </table>
    </div>
</section>

<!-- Code Section: Redis -->
<section class="section">
    <div class="container">
        <h2 class="section-title">Production Implementation: Redlock</h2>
        <p class="section-subtitle">Not the tutorial version. The version that survives clock drift, GC pauses, and network partitions.</p>
        
        <div class="code-section">
            <div class="code-header">
                <div class="code-dots">
                    <span class="red"></span>
                    <span class="yellow"></span>
                    <span class="green"></span>
                </div>
                <span>redlock_manager.py</span>
            </div>
            <pre><code><span class="keyword">class</span> <span class="function">RedlockManager</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, redis_nodes, retry_count=<span class="number">3</span>):
        self.clients = [redis.Redis(**node) <span class="keyword">for</span> node <span class="keyword">in</span> redis_nodes]
        self.quorum = len(self.clients) // <span class="number">2</span> + <span class="number">1</span>
        self.clock_drift_factor = <span class="number">0.01</span>  <span class="comment"># Critical: account for clock skew</span>
    
    <span class="keyword">def</span> <span class="function">acquire</span>(self, resource: str, ttl_ms: int):
        lock_value = str(uuid.uuid4())
        start_time = self._current_time_ms()
        acquired_count = <span class="number">0</span>
        
        <span class="comment"># Try ALL nodes, not just until quorum</span>
        <span class="keyword">for</span> client <span class="keyword">in</span> self.clients:
            <span class="keyword">if</span> self._acquire_instance(client, resource, lock_value, ttl_ms):
                acquired_count += <span class="number">1</span>
        
        <span class="comment"># Calculate validity with drift compensation</span>
        elapsed = self._current_time_ms() - start_time
        drift = int(ttl_ms * self.clock_drift_factor) + <span class="number">2</span>
        validity_time = ttl_ms - elapsed - drift
        
        <span class="keyword">if</span> acquired_count >= self.quorum <span class="keyword">and</span> validity_time > <span class="number">0</span>:
            <span class="keyword">return</span> LockHandle(lock_value, validity_time)
        
        <span class="comment"># Failed - release everything, try again</span>
        self._release_all(resource, lock_value)
        <span class="keyword">return</span> <span class="keyword">None</span></code></pre>
        </div>
        
        <div class="warning-box">
            <h4>üî• The Lua Script Everyone Forgets</h4>
            <p>Never release a lock without verifying ownership. Without atomic check-and-delete, you might release someone else's lock after yours expired.</p>
        </div>
        
        <div class="code-section">
            <div class="code-header">
                <div class="code-dots">
                    <span class="red"></span>
                    <span class="yellow"></span>
                    <span class="green"></span>
                </div>
                <span>atomic_release.lua</span>
            </div>
            <pre><code><span class="comment">-- Atomic ownership verification + delete</span>
<span class="keyword">if</span> redis.call(<span class="string">"get"</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span>
    <span class="keyword">return</span> redis.call(<span class="string">"del"</span>, KEYS[<span class="number">1</span>])
<span class="keyword">else</span>
    <span class="keyword">return</span> <span class="number">0</span>  <span class="comment">-- Not our lock anymore</span>
<span class="keyword">end</span></code></pre>
        </div>
    </div>
</section>

<!-- Architecture Section -->
<section class="section section-dark">
    <div class="container">
        <h2 class="section-title">Fencing Tokens: The Missing Piece</h2>
        <p class="section-subtitle">Locks can expire during GC pauses. Fencing tokens prevent zombie processes from corrupting data.</p>
        
        <div class="architecture-box">
            <h3 style="color: #0369a1; margin-bottom: 20px;">Lock Acquisition Flow with Fencing</h3>
            <div class="architecture-flow">
                <div class="arch-node">Client A<br><small>fence: 33</small></div>
                <span class="arch-arrow">‚Üí</span>
                <div class="arch-node">Lock Service<br><small>issues fence: 34</small></div>
                <span class="arch-arrow">‚Üí</span>
                <div class="arch-node">Storage<br><small>rejects fence < 34</small></div>
            </div>
            <p style="color: #0369a1; margin-top: 30px;"><strong>Result:</strong> Even if Client A wakes up after GC pause thinking it has the lock, storage rejects writes with outdated fence token.</p>
        </div>
        
        <div class="code-section">
            <div class="code-header">
                <div class="code-dots">
                    <span class="red"></span>
                    <span class="yellow"></span>
                    <span class="green"></span>
                </div>
                <span>fenced_operation.py</span>
            </div>
            <pre><code><span class="keyword">def</span> <span class="function">write_with_fence</span>(self, data, fence_token):
    <span class="string">"""All writes must include fence token verification"""</span>
    result = self.db.execute(
        <span class="string">"""
        UPDATE resources 
        SET data = %s, fence_token = %s
        WHERE id = %s AND fence_token < %s
        """</span>,
        [data, fence_token, self.resource_id, fence_token]
    )
    
    <span class="keyword">if</span> result.rowcount == <span class="number">0</span>:
        <span class="keyword">raise</span> FenceTokenStaleError(
            <span class="string">f"Fence token {fence_token} is stale"</span>
        )</code></pre>
        </div>
    </div>
</section>

<!-- When to Use Section -->
<section class="section">
    <div class="container">
        <h2 class="section-title">Decision Framework</h2>
        <p class="section-subtitle">The right choice depends on your failure mode tolerance, not benchmark numbers.</p>
        
        <div class="feature-grid">
            <div class="feature-card">
                <div class="feature-icon">‚ö°</div>
                <h3>Choose Redis Redlock</h3>
                <p>Lock duration < 30 seconds. High throughput critical. Eventual consistency acceptable. E-commerce carts, rate limiting, idempotency keys.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üîí</div>
                <h3>Choose ZooKeeper</h3>
                <p>Strict linearizability required. Long-held locks. Leader election needed. Financial transactions, gaming platforms, casino solutions.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üîÑ</div>
                <h3>Choose Hybrid</h3>
                <p>Fast path with Redis, escalate to ZooKeeper on conflict. Best of both worlds for high-stakes distributed systems.</p>
            </div>
        </div>
    </div>
</section>

<!-- Pitfalls Section -->
<section class="section section-dark">
    <div class="container">
        <h2 class="section-title">Production Pitfalls We've Survived</h2>
        <p class="section-subtitle">Lessons from running distributed locks at scale across fintech, gaming, and enterprise platforms.</p>
        
        <div class="feature-grid">
            <div class="feature-card">
                <div class="feature-icon">üíÄ</div>
                <h3>GC Pause Lock Expiry</h3>
                <p>A 15-second GC pause on JVM. Lock TTL was 10 seconds. Client woke up, thought it had the lock, corrupted shared state. <strong>Solution:</strong> Fencing tokens + validity checking before every operation.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üßü</div>
                <h3>Zombie Process Writes</h3>
                <p>Process acquired lock, got OOM-killed, restarted with same PID, continued writing with stale lock handle. <strong>Solution:</strong> UUID-based lock values, not process identifiers.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">‚è∞</div>
                <h3>Clock Drift Disaster</h3>
                <p>One server's clock was 3 seconds ahead. Lock appeared valid locally but expired on other nodes. <strong>Solution:</strong> 1% clock drift factor + NTP monitoring alerts.</p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="container">
        <h2>Stop Building Broken Locks</h2>
        <p>Production distributed systems require production-grade concurrency control. See how enterprise platforms implement fault-tolerant locking at scale.</p>
        <a href="https://power-soft.org/%EC%B9%B4%EC%A7%80%EB%85%B8-%EC%86%94%EB%A3%A8%EC%85%98-%EC%A0%9C%EC%9E%91-%EC%B9%B4%EC%A7%80%EB%85%B8-%EC%86%94%EB%A3%A8%EC%85%98-%EB%B6%84%EC%96%91/" class="cta-button">Explore Enterprise Architecture ‚Üí</a>
    </div>
</section>

<!-- Footer -->
<footer>
    <div class="container">
        <p style="margin-bottom: 15px;"><strong>PowerSoft Engineering</strong> | Distributed Systems Series | February 2026</p>
        <p>
            <a href="https://power-soft.org/%EC%B9%B4%EC%A7%80%EB%85%B8-%EC%86%94%EB%A3%A8%EC%85%98-%EC%A0%9C%EC%9E%91-%EC%B9%B4%EC%A7%80%EB%85%B8-%EC%86%94%EB%A3%A8%EC%85%98-%EB%B6%84%EC%96%91/">Enterprise Solutions</a> ¬∑ 
            <a href="https://power-soft.org/">Technical Documentation</a>
        </p>
        <p style="margin-top: 30px; color: #444;">¬© 2026 PowerSoft. All rights reserved.</p>
    </div>
</footer>

</body>
</html>
